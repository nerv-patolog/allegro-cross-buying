{"version":3,"file":"background.js","sources":["../../../src/background/background.js"],"sourcesContent":["// Proxy server configuration\n// This will be replaced by Vite during build with value from .env\nconst PROXY_BASE_URL = import.meta.env.VITE_PROXY_URL || 'http://localhost:3000';\n\nasync function findCommonSellers(productUrls) {\n  console.log('Finding common sellers via server...');\n\n  // Get API key from storage (optional)\n  const { proxyApiKey } = await chrome.storage.local.get(['proxyApiKey']);\n\n  try {\n    const headers = {\n      'Content-Type': 'application/json'\n    };\n\n    // Add API key if configured\n    if (proxyApiKey) {\n      headers['X-API-Key'] = proxyApiKey;\n    }\n\n    const response = await fetch(`${PROXY_BASE_URL}/api/sellers/find-common`, {\n      method: 'POST',\n      headers,\n      body: JSON.stringify({\n        urls: productUrls\n      })\n    });\n\n    if (!response.ok) {\n      let errorData;\n      try {\n        errorData = await response.json();\n      } catch (e) {\n        errorData = await response.text();\n      }\n      console.error('Server error:', response.status, errorData);\n      throw new Error(`Server Error ${response.status}: ${errorData.error || errorData.message || errorData}`);\n    }\n\n    const data = await response.json();\n    console.log('Server response:', data);\n\n    // Return full response including grouped sellers\n    return data;\n\n  } catch (error) {\n    // Check if server is running\n    if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {\n      throw new Error(`Cannot connect to server at ${PROXY_BASE_URL}. Make sure the server is running (npm start in server/ folder)`);\n    }\n    throw error;\n  }\n}\n\n// Message listener\nchrome.runtime.onMessage.addListener((request, _sender, sendResponse) => {\n  if (request.action === 'findCommonSellers') {\n    findCommonSellers(request.productUrls)\n      .then((results) => {\n        sendResponse({ results });\n      })\n      .catch((error) => {\n        console.error('Error finding common sellers:', error);\n        sendResponse({ error: error.message });\n      });\n\n    return true; // Keep the message channel open for async response\n  }\n});\n"],"names":[],"mappings":";;AAEA,QAAM,iBAAiB;AAEvB,iBAAe,kBAAkB,aAAa;AAC5C,YAAQ,IAAI,sCAAsC;AAGlD,UAAM,EAAE,YAAA,IAAgB,MAAM,OAAO,QAAQ,MAAM,IAAI,CAAC,aAAa,CAAC;AAEtE,QAAI;AACF,YAAM,UAAU;AAAA,QACd,gBAAgB;AAAA,MAAA;AAIlB,UAAI,aAAa;AACf,gBAAQ,WAAW,IAAI;AAAA,MACzB;AAEA,YAAM,WAAW,MAAM,MAAM,GAAG,cAAc,4BAA4B;AAAA,QACxE,QAAQ;AAAA,QACR;AAAA,QACA,MAAM,KAAK,UAAU;AAAA,UACnB,MAAM;AAAA,QAAA,CACP;AAAA,MAAA,CACF;AAED,UAAI,CAAC,SAAS,IAAI;AAChB,YAAI;AACJ,YAAI;AACF,sBAAY,MAAM,SAAS,KAAA;AAAA,QAC7B,SAAS,GAAG;AACV,sBAAY,MAAM,SAAS,KAAA;AAAA,QAC7B;AACA,gBAAQ,MAAM,iBAAiB,SAAS,QAAQ,SAAS;AACzD,cAAM,IAAI,MAAM,gBAAgB,SAAS,MAAM,KAAK,UAAU,SAAS,UAAU,WAAW,SAAS,EAAE;AAAA,MACzG;AAEA,YAAM,OAAO,MAAM,SAAS,KAAA;AAC5B,cAAQ,IAAI,oBAAoB,IAAI;AAGpC,aAAO;AAAA,IAET,SAAS,OAAO;AAEd,UAAI,MAAM,QAAQ,SAAS,iBAAiB,KAAK,MAAM,QAAQ,SAAS,cAAc,GAAG;AACvF,cAAM,IAAI,MAAM,+BAA+B,cAAc,iEAAiE;AAAA,MAChI;AACA,YAAM;AAAA,IACR;AAAA,EACF;AAGA,SAAO,QAAQ,UAAU,YAAY,CAAC,SAAS,SAAS,iBAAiB;AACvE,QAAI,QAAQ,WAAW,qBAAqB;AAC1C,wBAAkB,QAAQ,WAAW,EAClC,KAAK,CAAC,YAAY;AACjB,qBAAa,EAAE,SAAS;AAAA,MAC1B,CAAC,EACA,MAAM,CAAC,UAAU;AAChB,gBAAQ,MAAM,iCAAiC,KAAK;AACpD,qBAAa,EAAE,OAAO,MAAM,QAAA,CAAS;AAAA,MACvC,CAAC;AAEH,aAAO;AAAA,IACT;AAAA,EACF,CAAC;;"}